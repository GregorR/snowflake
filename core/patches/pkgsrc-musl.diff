diff -r b7cf414332ca Makefile
--- a/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -91,6 +91,7 @@
 SUBDIR+=	wm
 SUBDIR+=	www
 .endif
+_WRAP_EXTRA_ARGS.CC+=	-DNOFILES_MAX=256
 
 SUBDIR+=	${USER_ADDITIONAL_PKGS}
 
diff -r b7cf414332ca archivers/pax/files/getid.c
--- a/archivers/pax/files/getid.c	Fri May 04 14:07:09 2012 +0000
+++ b/archivers/pax/files/getid.c	Sun May 06 13:12:36 2012 +0000
@@ -152,12 +152,14 @@
 	if (!grstart() || !pwstart())
 		return (0);
 
+#if 0
 				/* switch pwcache(3) lookup functions */
 	if (pwcache_groupdb(gi_setgroupent, gi_endgrent,
 			    gi_getgrnam, gi_getgrgid) == -1
 	    || pwcache_userdb(gi_setpassent, gi_endpwent,
 			    gi_getpwnam, gi_getpwuid) == -1)
 		return (0);
+#endif
 
 	return (1);
 }
diff -r b7cf414332ca archivers/pax/files/options.c
--- a/archivers/pax/files/options.c	Fri May 04 14:07:09 2012 +0000
+++ b/archivers/pax/files/options.c	Sun May 06 13:12:36 2012 +0000
@@ -107,6 +107,8 @@
 #include "mtree.h"
 #endif	/* SMALL */
 
+#include <strings.h>
+
 /*
  * Routines which handle command line options
  */
diff -r b7cf414332ca chat/irssi/Makefile
--- a/chat/irssi/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/chat/irssi/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -20,9 +20,9 @@
 USE_LIBTOOL=		yes
 USE_TOOLS+=		pkg-config
 
+# [Gregor] Removed --without-ncurses, since there's no other libtermcap
 CONFIGURE_ARGS+=	--with-terminfo \
 			--with-proxy \
-			--without-ncurses \
 			--sysconfdir=${PKG_SYSCONFDIR}
 
 EGDIR=		${PREFIX}/share/examples/irssi
diff -r b7cf414332ca databases/db4/distinfo
--- a/databases/db4/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/databases/db4/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -7,3 +7,4 @@
 SHA1 (patch-ab) = 8f9ecc47527d338e28ee1ce71e694eaf2bdceb92
 SHA1 (patch-ac) = 045a3b83b9c6c164382ec546b06ae248620552cf
 SHA1 (patch-ae) = 43e574154de93dba60392b09d6ebddbca1036849
+SHA1 (patch-aq) = 3baa90e922dc9cb075deee2a2a37d607affead9b
diff -r b7cf414332ca databases/db4/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/databases/db4/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,11 @@
+diff -r 7a6cd6105754 dist/configure
+--- dist/configure	Sat Apr 28 15:23:22 2012 +0000
++++ dist/configure	Sat Apr 28 15:24:05 2012 +0000
+@@ -18792,6 +18792,7 @@
+ /* end confdefs.h.  */
+ 
+ #include <pthread.h>
++#include <stdlib.h>
+ main() {
+ 	pthread_cond_t cond;
+ 	pthread_mutex_t mutex;
diff -r b7cf414332ca devel/bison/Makefile
--- a/devel/bison/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/bison/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -28,6 +28,7 @@
 # Avoid rebuilding manpage
 pre-build:
 	${TOUCH} ${WRKSRC}/doc/bison.1
+	sed -i 's/#elif 0/#elif 1/' -i ${WRKSRC}/lib/fseterr.c
 
 # "bison" wants a recent version of "gettext" which at least some
 # NetBSD versions don't provide. Figure out whether it will install
diff -r b7cf414332ca devel/bmake/files/suff.c
--- a/devel/bmake/files/suff.c	Fri May 04 14:07:09 2012 +0000
+++ b/devel/bmake/files/suff.c	Sun May 06 13:12:36 2012 +0000
@@ -67,6 +67,8 @@
  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  * SUCH DAMAGE.
  */
+ 
+#include <strings.h> /* for ffs */
 
 #ifndef MAKE_NATIVE
 static char rcsid[] = "$NetBSD: suff.c,v 1.4 2009/09/18 21:27:25 joerg Exp $";
diff -r b7cf414332ca devel/bmake/files/targ.c
--- a/devel/bmake/files/targ.c	Fri May 04 14:07:09 2012 +0000
+++ b/devel/bmake/files/targ.c	Sun May 06 13:12:36 2012 +0000
@@ -67,6 +67,8 @@
  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  * SUCH DAMAGE.
  */
+ 
+#include <strings.h> /* for ffs */
 
 #ifndef MAKE_NATIVE
 static char rcsid[] = "$NetBSD: targ.c,v 1.5 2011/06/18 22:39:46 bsiegert Exp $";
diff -r b7cf414332ca devel/bmake/files/unit-tests/test.exp
--- a/devel/bmake/files/unit-tests/test.exp	Fri May 04 14:07:09 2012 +0000
+++ b/devel/bmake/files/unit-tests/test.exp	Sun May 06 13:12:36 2012 +0000
@@ -27,6 +27,7 @@
 make: "error" line 3: just FYI
 make: "error" line 4: warning: this could be serious
 make: "error" line 5: this is fatal
+*** Error code 1 (ignored)
 UT_DOLLAR=This is $UT_FU
 UT_FOO=foobar is fubar
 UT_FU=fubar
@@ -46,9 +47,9 @@
 At first, I am
 happy
 and now: sad
-.ERROR: Looks like 'sad' is upset.
 *** Error code 1
 
+.ERROR: Looks like 'sad' is upset.
 Stop.
 make: stopped in unit-tests
 simple.1
@@ -75,11 +76,11 @@
 shared.2.1
 shared.2.99
 shared.2.99
+cycle.1.99
 make: Graph cycles through `cycle.2.99'
 make: Graph cycles through `cycle.2.98'
 make: Graph cycles through `cycle.2.97'
 cycle.1.99
-cycle.1.99
 .for with :S;... OK
 b2af338b
 3360ac65
@@ -343,4 +344,3 @@
 six v=is y k=is y
 show-v v=override k=override
 *** Error code 1 (ignored)
-*** Error code 1 (ignored)
diff -r b7cf414332ca devel/flex/PLIST
--- a/devel/flex/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/devel/flex/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -6,19 +6,3 @@
 lib/libfl.a
 lib/libfl_pic.a
 man/man1/flex.1
-share/locale/ca/LC_MESSAGES/flex.mo
-share/locale/da/LC_MESSAGES/flex.mo
-share/locale/de/LC_MESSAGES/flex.mo
-share/locale/es/LC_MESSAGES/flex.mo
-share/locale/fr/LC_MESSAGES/flex.mo
-share/locale/ga/LC_MESSAGES/flex.mo
-share/locale/ko/LC_MESSAGES/flex.mo
-share/locale/nl/LC_MESSAGES/flex.mo
-share/locale/pl/LC_MESSAGES/flex.mo
-share/locale/pt_BR/LC_MESSAGES/flex.mo
-share/locale/ro/LC_MESSAGES/flex.mo
-share/locale/ru/LC_MESSAGES/flex.mo
-share/locale/sv/LC_MESSAGES/flex.mo
-share/locale/tr/LC_MESSAGES/flex.mo
-share/locale/vi/LC_MESSAGES/flex.mo
-share/locale/zh_CN/LC_MESSAGES/flex.mo
diff -r b7cf414332ca devel/glib2/Makefile
--- a/devel/glib2/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/glib2/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -46,6 +46,12 @@
 
 LIBS.SunOS+=	-lnsl -lsocket
 
+
+
+# [Gregor] bugs in how it uses libdl
+pre-build:
+	sed -i 's/if (msg)/if (!p \&\& msg)/' ${WRKSRC}/gmodule/gmodule-dl.c
+
 .include "../../converters/libiconv/buildlink3.mk"
 .include "../../devel/gettext-lib/buildlink3.mk"
 .include "../../devel/pcre/buildlink3.mk"
diff -r b7cf414332ca devel/gmake/Makefile
--- a/devel/gmake/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/gmake/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -47,6 +47,8 @@
 CONFIGURE_ARGS+=	ac_cv_func_strndup=no
 .endif
 
+CONFIGURE_ARGS+=	CFLAGS="-O2 -g -D__BEOS__"
+
 post-install:
 	${CHMOD} g-s ${DESTDIR}${PREFIX}/bin/${GNU_PROGRAM_PREFIX}make
 	${CHGRP} ${BINGRP} ${DESTDIR}${PREFIX}/bin/${GNU_PROGRAM_PREFIX}make
diff -r b7cf414332ca devel/imake/Makefile
--- a/devel/imake/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/imake/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -42,6 +42,9 @@
 SUBST_FILES.xmkmf=	xmkmf
 SUBST_SED.xmkmf=	-e "s/^configdirspec= */configdirspec=/"
 
+pre-build:
+	sed 's/-x c -/-x c - -x none/' -i ${WRKSRC}/imake.c
+
 .include "../../x11/xproto/buildlink3.mk"
 
 .include "../../mk/bsd.pkg.mk"
diff -r b7cf414332ca devel/libblkid/distinfo
--- a/devel/libblkid/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/devel/libblkid/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -10,3 +10,4 @@
 SHA1 (patch-ae) = df77e8c6da425609309505fd447b66ade05426a3
 SHA1 (patch-af) = ba6e34b5635437e755192064bfc5865bfa9c913a
 SHA1 (patch-ag) = 1898774d311562938281f825b50a0e9aa44a447d
+SHA1 (patch-aq) = cb51811a855ad078e36113223c7afc3f19f5c32e
diff -r b7cf414332ca devel/libblkid/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/devel/libblkid/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,56 @@
+diff -r 4aa4d9dd485b shlibs/blkid/src/Makefile.am
+--- shlibs/blkid/src/Makefile.am	Sun May 06 03:11:57 2012 +0000
++++ shlibs/blkid/src/Makefile.am	Sun May 06 03:12:33 2012 +0000
+@@ -59,15 +59,15 @@
+ 
+ # move lib from $(usrlib_execdir) to $(libdir) if needed
+ install-exec-hook:
+-	if test "$(usrlib_execdir)" != "$(libdir)"; then \
+-		mkdir -p $(DESTDIR)$(libdir); \
+-		mv $(DESTDIR)$(usrlib_execdir)/libblkid.so.* $(DESTDIR)$(libdir); \
+-		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libblkid.so); \
+-		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
+-		(cd $(DESTDIR)$(usrlib_execdir) && \
+-			rm -f libblkid.so && \
+-			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libblkid.so); \
+-	fi
++#	if test "$(usrlib_execdir)" != "$(libdir)"; then \
++#		mkdir -p $(DESTDIR)$(libdir); \
++#		mv $(DESTDIR)$(usrlib_execdir)/libblkid.so.* $(DESTDIR)$(libdir); \
++#		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libblkid.so); \
++#		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
++#		(cd $(DESTDIR)$(usrlib_execdir) && \
++#			rm -f libblkid.so && \
++#			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libblkid.so); \
++#	fi
+ 
+ uninstall-hook:
+ 	rm -f $(DESTDIR)$(libdir)/libblkid.so*
+diff -r 4aa4d9dd485b shlibs/blkid/src/Makefile.in
+--- shlibs/blkid/src/Makefile.in	Sun May 06 03:11:57 2012 +0000
++++ shlibs/blkid/src/Makefile.in	Sun May 06 03:12:33 2012 +0000
+@@ -922,15 +922,15 @@
+ 
+ # move lib from $(usrlib_execdir) to $(libdir) if needed
+ install-exec-hook:
+-	if test "$(usrlib_execdir)" != "$(libdir)"; then \
+-		mkdir -p $(DESTDIR)$(libdir); \
+-		mv $(DESTDIR)$(usrlib_execdir)/libblkid.so.* $(DESTDIR)$(libdir); \
+-		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libblkid.so); \
+-		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
+-		(cd $(DESTDIR)$(usrlib_execdir) && \
+-			rm -f libblkid.so && \
+-			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libblkid.so); \
+-	fi
++#	if test "$(usrlib_execdir)" != "$(libdir)"; then \
++#		mkdir -p $(DESTDIR)$(libdir); \
++#		mv $(DESTDIR)$(usrlib_execdir)/libblkid.so.* $(DESTDIR)$(libdir); \
++#		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libblkid.so); \
++#		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
++#		(cd $(DESTDIR)$(usrlib_execdir) && \
++#			rm -f libblkid.so && \
++#			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libblkid.so); \
++#	fi
+ 
+ uninstall-hook:
+ 	rm -f $(DESTDIR)$(libdir)/libblkid.so*
diff -r b7cf414332ca devel/libuuid/distinfo
--- a/devel/libuuid/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/devel/libuuid/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -4,3 +4,4 @@
 RMD160 (util-linux-2.19.1.tar.bz2) = e4763d21a3a32029ccc525a0222e271f0946a4fd
 Size (util-linux-2.19.1.tar.bz2) = 4396543 bytes
 SHA1 (patch-aa) = 07d66ef414f5781d75159b446d6c822b1e543477
+SHA1 (patch-aq) = f8ededcca54e2adb13f57e564623178f4d46ced6
diff -r b7cf414332ca devel/libuuid/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/devel/libuuid/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,56 @@
+diff -r f3d747a80d82 shlibs/uuid/src/Makefile.am
+--- shlibs/uuid/src/Makefile.am	Sun May 06 03:03:55 2012 +0000
++++ shlibs/uuid/src/Makefile.am	Sun May 06 03:04:28 2012 +0000
+@@ -25,15 +25,15 @@
+ 
+ # move lib from $(usrlib_execdir) to $(libdir) if needed
+ install-exec-hook:
+-	if test "$(usrlib_execdir)" != "$(libdir)"; then \
+-		mkdir -p $(DESTDIR)$(libdir); \
+-		mv $(DESTDIR)$(usrlib_execdir)/libuuid.so.* $(DESTDIR)$(libdir); \
+-		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libuuid.so); \
+-		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
+-		(cd $(DESTDIR)$(usrlib_execdir) && \
+-			rm -f libuuid.so && \
+-			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libuuid.so); \
+-	fi
++#	if test "$(usrlib_execdir)" != "$(libdir)"; then \
++#		mkdir -p $(DESTDIR)$(libdir); \
++#		mv $(DESTDIR)$(usrlib_execdir)/libuuid.so.* $(DESTDIR)$(libdir); \
++#		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libuuid.so); \
++#		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
++#		(cd $(DESTDIR)$(usrlib_execdir) && \
++#			rm -f libuuid.so && \
++#			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libuuid.so); \
++#	fi
+ 
+ uninstall-hook:
+ 	rm -f $(DESTDIR)$(libdir)/libuuid.so*
+diff -r f3d747a80d82 shlibs/uuid/src/Makefile.in
+--- shlibs/uuid/src/Makefile.in	Sun May 06 03:03:55 2012 +0000
++++ shlibs/uuid/src/Makefile.in	Sun May 06 03:04:28 2012 +0000
+@@ -700,15 +700,15 @@
+ 
+ # move lib from $(usrlib_execdir) to $(libdir) if needed
+ install-exec-hook:
+-	if test "$(usrlib_execdir)" != "$(libdir)"; then \
+-		mkdir -p $(DESTDIR)$(libdir); \
+-		mv $(DESTDIR)$(usrlib_execdir)/libuuid.so.* $(DESTDIR)$(libdir); \
+-		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libuuid.so); \
+-		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
+-		(cd $(DESTDIR)$(usrlib_execdir) && \
+-			rm -f libuuid.so && \
+-			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libuuid.so); \
+-	fi
++#	if test "$(usrlib_execdir)" != "$(libdir)"; then \
++#		mkdir -p $(DESTDIR)$(libdir); \
++#		mv $(DESTDIR)$(usrlib_execdir)/libuuid.so.* $(DESTDIR)$(libdir); \
++#		so_img_name=$$(readlink $(DESTDIR)$(usrlib_execdir)/libuuid.so); \
++#		so_img_rel_target=$$(echo $(usrlib_execdir) | sed 's,\(^/\|\)[^/][^/]*,..,g'); \
++#		(cd $(DESTDIR)$(usrlib_execdir) && \
++#			rm -f libuuid.so && \
++#			$(LN_S) $$so_img_rel_target$(libdir)/$$so_img_name libuuid.so); \
++#	fi
+ 
+ uninstall-hook:
+ 	rm -f $(DESTDIR)$(libdir)/libuuid.so*
diff -r b7cf414332ca devel/m4/distinfo
--- a/devel/m4/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/devel/m4/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -6,3 +6,4 @@
 SHA1 (patch-aa) = ef316620b49f78f46e9dea47032b0141814c1f43
 SHA1 (patch-ab) = b29840365e983623bce64e84ceab3504b8270b32
 SHA1 (patch-ac) = 7bd9164c659727a906ef54a2f1027e9fd19315ba
+SHA1 (patch-aq) = 361e3294fe76fd67087d4fb212fd16c79462a953
diff -r b7cf414332ca devel/m4/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/devel/m4/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,10 @@
+--- lib/freadahead.c
++++ lib/freadahead.c
+@@ -80,6 +80,6 @@
+   abort ();
+   return 0;
+ #else
+- #error "Please port gnulib freadahead.c to your platform! Look at the definition of fflush, fread, ungetc on your system, then report this to bug-gnulib."
++  return 1;
+ #endif
+ }
diff -r b7cf414332ca devel/ncurses/Makefile
--- a/devel/ncurses/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/ncurses/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -38,6 +38,9 @@
 
 PLIST_SRC=	${PKGDIR}/PLIST ${WRKDIR}/PLIST.terminfo
 
+# [Gregor] C++ build doesn't work
+CONFIGURE_ARGS+=	--without-cxx
+
 post-configure:
 	cd ${WRKSRC}/man;					\
 	for f in *.1m; do					\
diff -r b7cf414332ca devel/ncurses/Makefile.common
--- a/devel/ncurses/Makefile.common	Fri May 04 14:07:09 2012 +0000
+++ b/devel/ncurses/Makefile.common	Sun May 06 13:12:36 2012 +0000
@@ -16,14 +16,15 @@
 PKG_INSTALLATION_TYPES=	overwrite pkgviews
 PKG_DESTDIR_SUPPORT=	user-destdir
 
-USE_LANGUAGES=		c c++
+USE_LANGUAGES=		c
 USE_LIBTOOL=		yes
 USE_TOOLS+=		tbl
 GNU_CONFIGURE=		yes
 CONFIGURE_ARGS+=	--with-libtool
 CONFIGURE_ARGS+=	--enable-bsdpad
 CONFIGURE_ARGS+=	--enable-overwrite
-CONFIGURE_ARGS+=	--with-cxx-binding
+# [Gregor] No C++
+#CONFIGURE_ARGS+=	--with-cxx-binding
 CONFIGURE_ARGS+=	--without-ada
 CONFIGURE_ARGS+=	--without-gpm
 CONFIGURE_ARGS+=	--with-manpage-format=normal
diff -r b7cf414332ca devel/ncurses/PLIST
--- a/devel/ncurses/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/devel/ncurses/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -11,14 +11,7 @@
 bin/tput
 bin/tset
 include/ncurses/curses.h
-include/ncurses/cursesapp.h
-include/ncurses/cursesf.h
-include/ncurses/cursesm.h
-include/ncurses/cursesp.h
-include/ncurses/cursesw.h
-include/ncurses/cursslk.h
 include/ncurses/eti.h
-include/ncurses/etip.h
 include/ncurses/form.h
 include/ncurses/menu.h
 include/ncurses/nc_tparm.h
@@ -32,7 +25,6 @@
 include/ncurses/unctrl.h
 lib/libform.la
 lib/libmenu.la
-lib/libncurses++.la
 lib/libncurses.la
 lib/libpanel.la
 man/man1/captoinfo.1
diff -r b7cf414332ca devel/pcre/Makefile
--- a/devel/pcre/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/devel/pcre/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -21,6 +21,8 @@
 CONFIGURE_ARGS+=	--enable-utf8 --enable-unicode-properties
 CONFIGURE_ARGS+=	--enable-pcre16
 
+CONFIGURE_ARGS+=	--disable-cpp
+
 SUBST_CLASSES+=		rpath
 SUBST_STAGE.rpath=	pre-configure
 SUBST_MESSAGE.rpath=	Fixing rpath output in pcre-config
diff -r b7cf414332ca devel/pcre/PLIST
--- a/devel/pcre/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/devel/pcre/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -3,18 +3,12 @@
 bin/pcregrep
 bin/pcretest
 include/pcre.h
-include/pcre_scanner.h
-include/pcre_stringpiece.h
-include/pcrecpp.h
-include/pcrecpparg.h
 include/pcreposix.h
 lib/libpcre.la
 lib/libpcre16.la
-lib/libpcrecpp.la
 lib/libpcreposix.la
 lib/pkgconfig/libpcre.pc
 lib/pkgconfig/libpcre16.pc
-lib/pkgconfig/libpcrecpp.pc
 lib/pkgconfig/libpcreposix.pc
 man/man1/pcre-config.1
 man/man1/pcregrep.1
@@ -75,7 +69,6 @@
 man/man3/pcrebuild.3
 man/man3/pcrecallout.3
 man/man3/pcrecompat.3
-man/man3/pcrecpp.3
 man/man3/pcrejit.3
 man/man3/pcrelimits.3
 man/man3/pcrematching.3
@@ -127,7 +120,6 @@
 share/doc/pcre/html/pcrebuild.html
 share/doc/pcre/html/pcrecallout.html
 share/doc/pcre/html/pcrecompat.html
-share/doc/pcre/html/pcrecpp.html
 share/doc/pcre/html/pcredemo.html
 share/doc/pcre/html/pcregrep.html
 share/doc/pcre/html/pcrejit.html
diff -r b7cf414332ca graphics/MesaLib/Makefile
--- a/graphics/MesaLib/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/graphics/MesaLib/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -72,6 +72,7 @@
 
 pre-build:
 	cd ${WRKSRC} && ${RM} -fr src/glu src/glut progs
+	sed -i 's/#if defined(__linux__) && defined(__i386__)/#if 0/' ${WRKSRC}/src/mesa/main/glheader.h
 
 .include "../../mk/compiler.mk"
 
diff -r b7cf414332ca graphics/cairo/Makefile
--- a/graphics/cairo/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/graphics/cairo/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -38,6 +38,8 @@
 # For snprintf() and ctime_r()
 CPPFLAGS.SunOS+=		-D__EXTENSIONS__ -D_POSIX_PTHREAD_SEMANTICS
 
+CPPFLAGS+=		-Dffs=__builtin_ffs
+
 TEST_TARGET=			check
 
 # PR#43928
diff -r b7cf414332ca graphics/gdk-pixbuf2/PLIST
--- a/graphics/gdk-pixbuf2/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/graphics/gdk-pixbuf2/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -72,104 +72,3 @@
 share/gtk-doc/html/gdk-pixbuf/rn02.html
 share/gtk-doc/html/gdk-pixbuf/style.css
 share/gtk-doc/html/gdk-pixbuf/up.png
-share/locale/af/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ang/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ar/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/as/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ast/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/az/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/be/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/be@latin/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/bg/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/bn/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/bn_IN/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/br/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/bs/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ca/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ca@valencia/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/crh/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/cs/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/cy/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/da/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/de/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/dz/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/el/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/en@shaw/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/en_CA/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/en_GB/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/eo/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/es/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/et/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/eu/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/fa/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/fi/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/fr/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ga/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/gl/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/gu/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/he/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/hi/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/hr/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/hu/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/hy/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ia/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/id/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/io/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/is/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/it/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ja/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ka/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/kn/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ko/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ku/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/li/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/lt/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/lv/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/mai/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/mi/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/mk/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ml/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/mn/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/mr/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ms/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/my/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/nb/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/nds/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ne/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/nl/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/nn/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/nso/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/oc/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/or/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/pa/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/pl/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ps/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/pt/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/pt_BR/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ro/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ru/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/si/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sk/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sl/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sq/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sr/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sr@ije/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sr@latin/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/sv/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ta/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/te/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/th/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/tk/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/tr/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/tt/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/ug/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/uk/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/uz/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/uz@cyrillic/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/vi/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/wa/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/xh/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/yi/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/zh_CN/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/zh_HK/LC_MESSAGES/gdk-pixbuf.mo
-share/locale/zh_TW/LC_MESSAGES/gdk-pixbuf.mo
diff -r b7cf414332ca graphics/jpeg/buildlink3.mk
--- a/graphics/jpeg/buildlink3.mk	Fri May 04 14:07:09 2012 +0000
+++ b/graphics/jpeg/buildlink3.mk	Sun May 06 13:12:36 2012 +0000
@@ -5,9 +5,10 @@
 .if !defined(JPEG_BUILDLINK3_MK)
 JPEG_BUILDLINK3_MK:=
 
-BUILDLINK_API_DEPENDS.jpeg+=	jpeg>=8nb1
-#BUILDLINK_ABI_DEPENDS.jpeg+=	jpeg>=8nb1
-BUILDLINK_ABI_DEPENDS.jpeg?=	jpeg>=8nb1
+# [Gregor] Reduced to 8 due to version diffs between pkgresolve and pkgsrc
+BUILDLINK_API_DEPENDS.jpeg+=	jpeg>=8
+#BUILDLINK_ABI_DEPENDS.jpeg+=	jpeg>=8
+BUILDLINK_ABI_DEPENDS.jpeg?=	jpeg>=8
 BUILDLINK_PKGSRCDIR.jpeg?=	../../graphics/jpeg
 .endif # JPEG_BUILDLINK3_MK
 
diff -r b7cf414332ca lang/f2c/distinfo
--- a/lang/f2c/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/lang/f2c/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -6,3 +6,4 @@
 SHA1 (patch-aa) = f1224ff17cdc96f083a247dce88b690e8b939eb0
 SHA1 (patch-ad) = 7f204a45891e3632589ea8fb0e4e379a0a792dea
 SHA1 (patch-ak) = 8652a54df300ddd60d9b1a9594d312349b782cf4
+SHA1 (patch-aq) = dd5d4e79bd1d61d7ce152b0934667ba4a1888692
diff -r b7cf414332ca lang/f2c/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/lang/f2c/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,13 @@
+diff -r 6bba7eaf719c src/sysdep.c
+--- src/sysdep.c	Sat Apr 28 14:46:46 2012 +0000
++++ src/sysdep.c	Sat Apr 28 14:47:22 2012 +0000
+@@ -83,6 +83,9 @@
+ #include <sys/wait.h>
+ #include <unistd.h>
+ 
++#include <sys/types.h>
++#include <sys/stat.h>
++
+  void
+ #ifdef KR_headers
+ Un_link_all(cdelete)
diff -r b7cf414332ca lang/perl5/Makefile
--- a/lang/perl5/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/lang/perl5/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -50,6 +50,7 @@
 CONFIGURE_ARGS+=	-sde
 CONFIGURE_ARGS+=	-D ccflags=${CFLAGS:Q}
 CONFIGURE_ARGS+=	-D ldflags=${LDFLAGS:Q}
+CONFIGURE_ARGS+=        -D inc_version_list=none
 MAKE_ENV+=		LC_ALL="C"
 
 TEST_TARGET=		test
@@ -320,6 +321,10 @@
 
 pre-configure:
 	cd ${WRKSRC} && find `pwd` -name "*.orig" -type f -exec ${RM} -f {} \;
+	sed 's/-fstack-protector/-fno-stack-protector/g' -i ${WRKSRC}/Configure
+	
+pre-build:	
+	sed 's/define HAS_CRYPT_R/undef HAS_CRYPT_R/g' -i ${WRKSRC}/config.h
 
 post-build:
 	${SED}	-e "s,@PERL5@,"${PERL5:Q}",g"				\
diff -r b7cf414332ca lang/python26/Makefile
--- a/lang/python26/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/lang/python26/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -118,22 +118,7 @@
 .endif
 
 PLIST_VARS+=	dll nis no-nis
-.if ${OPSYS} == "IRIX"
-.  if ${ABI} == "64"
-PLIST.no-nis=	yes
-.  else
-PLIST.nis=	yes
-.  endif
-.else
 PLIST.dll=	yes
-.  if ${OPSYS} == "MirBSD"
-# neither nis nor no-nis
-.  elif ${OPSYS} != "NetBSD" || exists(/usr/bin/ypcat)
-PLIST.nis=	yes
-.  else
-PLIST.no-nis=	yes
-.  endif
-.endif
 
 .include "../../mk/bdb.buildlink3.mk"
 MAKE_ENV+=	PY_BDB_TYPE=${BDB_TYPE}
diff -r b7cf414332ca lang/python27/PLIST.common
--- a/lang/python27/PLIST.common	Fri May 04 14:07:09 2012 +0000
+++ b/lang/python27/PLIST.common	Sun May 06 13:12:36 2012 +0000
@@ -1835,7 +1835,6 @@
 lib/python${PY_VER_SUFFIX}/lib-dynload/itertools.so
 lib/python${PY_VER_SUFFIX}/lib-dynload/math.so
 lib/python${PY_VER_SUFFIX}/lib-dynload/mmap.so
-${PLIST.nis}lib/python${PY_VER_SUFFIX}/lib-dynload/nis.so
 ${PLIST.no-nis}lib/python${PY_VER_SUFFIX}/lib-dynload/nis_failed.so
 lib/python${PY_VER_SUFFIX}/lib-dynload/operator.so
 lib/python${PY_VER_SUFFIX}/lib-dynload/parser.so
diff -r b7cf414332ca meta-pkgs/xfce4/Makefile
--- a/meta-pkgs/xfce4/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/meta-pkgs/xfce4/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -16,7 +16,8 @@
 .include "../../print/xfce4-print/buildlink3.mk"
 .include "../../sysutils/xfce4-appfinder/buildlink3.mk"
 .include "../../sysutils/xfce4-thunar/buildlink3.mk"
-.include "../../sysutils/xfce4-volman/buildlink3.mk"
+# [Gregor] volman depends on hal
+#.include "../../sysutils/xfce4-volman/buildlink3.mk"
 .include "../../sysutils/xfce4-xarchiver/buildlink3.mk"
 .include "../../time/xfce4-orage/buildlink3.mk"
 .include "../../wm/xfce4-wm-themes/buildlink3.mk"
diff -r b7cf414332ca misc/pty-redir/distinfo
--- a/misc/pty-redir/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/misc/pty-redir/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -4,3 +4,4 @@
 RMD160 (pty-redir-0.1.tar.gz) = 75347881746dd1419e95e2ada30b23b2d9c0d223
 Size (pty-redir-0.1.tar.gz) = 8405 bytes
 SHA1 (patch-aa) = 28f8a1c22a9bf602e0e447ca45736e7cde6fddd5
+SHA1 (patch-aq) = 17bdbfdef55312079c5ab32069556b50658dd771
diff -r b7cf414332ca misc/pty-redir/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/misc/pty-redir/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,51 @@
+--- pty-redir.c
++++ pty-redir.c
+@@ -43,30 +43,18 @@
+ #include <fcntl.h>
+ 
+ 
+-#define PTY00 "/dev/ptyXX"
+-#define PTY10 "pqrs"
+-#define PTY01 "0123456789abcdef"
++#define PTY00 "/dev/ptmx"
+ 
+ static int
+ getPtyMaster(char *tty10, char *tty01)
+ {
+-    char *p10;
+-    char *p01;
+     static char dev[] = PTY00;
+     int fd;
+ 
+-    for (p10 = PTY10; *p10 != '\0'; p10++) {
+-        dev[8] = *p10;
+-        for (p01 = PTY01; *p01 != '\0'; p01++) {
+-            dev[9] = *p01;
+             fd = open(dev, O_RDWR);
+             if (fd >= 0) {
+-                *tty10 = *p10;
+-                *tty01 = *p01;
+                 return fd;
+             }
+-        }
+-    }
+     fprintf(stderr,"Ran out of pty.\n");
+     exit(1);
+     return fd;
+@@ -81,8 +69,6 @@
+ 	int i;
+ 	
+ 	fd=getPtyMaster(&a,&b);
+-	fprintf(stdout,"/dev/tty%c%c",a,b);
+-	fflush(stdout);
+ 	if(NULL==(args=malloc((argc)*sizeof(char *))))
+ 	{
+ 		fprintf(stderr,"Virtual memory exhausted\n");
+@@ -95,7 +81,6 @@
+ 	args[argc-1]=NULL; /*End of params*/
+ 	dup2(fd,0);
+ 	dup2(fd,1);
+-	fflush(NULL);
+ 	if(fork())
+ 	{
+ 		exit(0);
diff -r b7cf414332ca net/libfetch/files/ftp.c
--- a/net/libfetch/files/ftp.c	Fri May 04 14:07:09 2012 +0000
+++ b/net/libfetch/files/ftp.c	Sun May 06 13:12:36 2012 +0000
@@ -59,8 +59,10 @@
 
 #ifdef __linux__
 /* Keep this down to Linux, it can create surprises else where. */
+#ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
+#endif
 
 #if HAVE_CONFIG_H
 #include "config.h"
diff -r b7cf414332ca net/libfetch/files/http.c
--- a/net/libfetch/files/http.c	Fri May 04 14:07:09 2012 +0000
+++ b/net/libfetch/files/http.c	Sun May 06 13:12:36 2012 +0000
@@ -65,8 +65,10 @@
 
 #if defined(__linux__) || defined(__MINT__)
 /* Keep this down to Linux or MiNT, it can create surprises elsewhere. */
+#ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
+#endif
 
 /* Needed for gmtime_r on Interix */
 #define _REENTRANT
diff -r b7cf414332ca net/tightvnc/Makefile
--- a/net/tightvnc/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/net/tightvnc/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -28,6 +28,7 @@
 .if !empty(MACHINE_PLATFORM:MNetBSD-*-x86_64)
 _WRAP_EXTRA_ARGS.CC+=	-DDDXTIME -D_XSERVER64 -DGCCUSESGAS
 .endif
+_WRAP_EXTRA_ARGS.CC+=	-DNOFILES_MAX=256
 
 .if ${X11_TYPE} == "modular"
 DEPENDS+=		rgb>=1.0.1:../../x11/rgb
@@ -56,6 +57,11 @@
 
 INSTALLATION_DIRS=	bin ${PKGMANDIR}/man1 share/examples/tightvnc
 
+pre-build:
+	echo '#define DEFAULT_CPP "cpp"' >> ${WRKSRC}/Xvnc/config/imake/imakemdep.h
+	sed -i 's/alloca/malloc/g ; s/-x c -/-x c - -x none/' ${WRKSRC}/Xvnc/config/imake/imake.c
+	sed -i 's/HasFfsl[ \t]*YES/HasFfsl NO/' ${WRKSRC}/Xvnc/config/cf/linux.cf
+
 do-install:
 	${INSTALL_PROGRAM} ${WRKSRC}/Xvnc/programs/Xserver/Xvnc \
 	    ${DESTDIR}${PREFIX}/bin/Xvnc
diff -r b7cf414332ca net/tnftp/files/libedit/tty.c
--- a/net/tnftp/files/libedit/tty.c	Fri May 04 14:07:09 2012 +0000
+++ b/net/tnftp/files/libedit/tty.c	Sun May 06 13:12:36 2012 +0000
@@ -40,6 +40,7 @@
  * tty.c: tty interface stuff
  */
 #include <assert.h>
+#include <strings.h>
 #include "tty.h"
 #include "el.h"
 
diff -r b7cf414332ca pkgtools/bootstrap-mk-files/files/mods/Linux.bsd.man.mk
--- a/pkgtools/bootstrap-mk-files/files/mods/Linux.bsd.man.mk	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/bootstrap-mk-files/files/mods/Linux.bsd.man.mk	Sun May 06 13:12:36 2012 +0000
@@ -13,6 +13,7 @@
 .endif
 
 .PHONY:		catinstall maninstall catpages manpages catlinks manlinks cleanman html installhtml cleanhtml
+MKMAN?=no
 .if ${MKMAN} != "no"
 realinstall:	${MANINSTALL}
 .endif
@@ -40,11 +41,10 @@
 TMACDIR?=	${DESTDIR}/usr/share/groff/tmac
 .endif
 HTMLDIR?=	${DESTDIR}/usr/share/man
-CATDEPS?=	${TMACDIR}/mandoc.tmac \
-		${TMACDIR}/doc.tmac
+CATDEPS?=
 MANTARGET?=	cat
-NROFF?=		nroff -Tascii
-GROFF?=		groff -Tascii
+NROFF?=		cat
+GROFF?=		cat
 TBL?=		tbl
 
 
diff -r b7cf414332ca pkgtools/libnbcompat/files/lchflags.c
--- a/pkgtools/libnbcompat/files/lchflags.c	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/libnbcompat/files/lchflags.c	Sun May 06 13:12:36 2012 +0000
@@ -39,6 +39,7 @@
 int
 lchflags(const char *path, unsigned long flags)
 {
+#if 0
 	struct stat psb;
 
 	if (lstat(path, &psb) == -1)
@@ -47,4 +48,6 @@
 		return 0;
 	}
 	return (chflags(path, flags));
+#endif
+	return -1;
 }
diff -r b7cf414332ca pkgtools/libnbcompat/files/unvis.c
--- a/pkgtools/libnbcompat/files/unvis.c	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/libnbcompat/files/unvis.c	Sun May 06 13:12:36 2012 +0000
@@ -83,6 +83,8 @@
 #define	isoctal(c)	(((unsigned char)(c)) >= '0' && ((unsigned char)(c)) <= '7')
 #define xtod(c)		(isdigit(c) ? (c - '0') : ((tolower(c) - 'a') + 10))
 
+int __nbcompat_unvis13(char *cp, int c, int *astate, int flag);
+
 int
 unvis(cp, c, astate, flag)
 	char *cp;
diff -r b7cf414332ca pkgtools/pkg_install-info/files/install-info.c
--- a/pkgtools/pkg_install-info/files/install-info.c	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install-info/files/install-info.c	Sun May 06 13:12:36 2012 +0000
@@ -21,6 +21,8 @@
 #include "system.h"
 #include <getopt.h>
 
+#include <stdlib.h>
+
 static char *progname = "install-info";
 
 int menu_line_equal (), menu_line_lessp ();
diff -r b7cf414332ca pkgtools/pkg_install-info/files/system.h
--- a/pkgtools/pkg_install-info/files/system.h	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install-info/files/system.h	Sun May 06 13:12:36 2012 +0000
@@ -21,7 +21,9 @@
 #ifndef TEXINFO_SYSTEM_H
 #define TEXINFO_SYSTEM_H
 
+#ifndef _GNU_SOURCE
 #define _GNU_SOURCE
+#endif
 
 #include <config.h>
 
diff -r b7cf414332ca pkgtools/pkg_install-info/files/xexit.c
--- a/pkgtools/pkg_install-info/files/xexit.c	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install-info/files/xexit.c	Sun May 06 13:12:36 2012 +0000
@@ -19,6 +19,8 @@
 
 #include "system.h"
 
+#include <stdlib.h>
+
 /* SunOS 4.1.1 gets STDC_HEADERS defined, but it doesn't provide
    EXIT_FAILURE.  So far no system has defined one of EXIT_FAILURE and
    EXIT_SUCCESS without the other.  */
diff -r b7cf414332ca pkgtools/pkg_install/files/add/Makefile.in
--- a/pkgtools/pkg_install/files/add/Makefile.in	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install/files/add/Makefile.in	Sun May 06 13:12:36 2012 +0000
@@ -22,7 +22,7 @@
 
 LIBS=		-linstall -lfetch
 .if !empty(SSL_SUPPORT)
-LIBS+=		-lcrypto
+LIBS+=		-lcrypto -lz
 .endif
 LIBS+=		@LIBS@
 
diff -r b7cf414332ca pkgtools/pkg_install/files/admin/Makefile.in
--- a/pkgtools/pkg_install/files/admin/Makefile.in	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install/files/admin/Makefile.in	Sun May 06 13:12:36 2012 +0000
@@ -30,7 +30,7 @@
 .if empty(BOOTSTRAP)
 LIBS=		-linstall -lfetch
 .if !empty(SSL_SUPPORT)
-LIBS+=		-lcrypto
+LIBS+=		-lcrypto -lz
 CFLAGS+=	-DHAVE_SSL
 .endif
 LIBS+=		@LIBS@
diff -r b7cf414332ca pkgtools/pkg_install/files/info/Makefile.in
--- a/pkgtools/pkg_install/files/info/Makefile.in	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install/files/info/Makefile.in	Sun May 06 13:12:36 2012 +0000
@@ -19,7 +19,7 @@
 .if empty(BOOTSTRAP)
 LIBS=		-linstall -lfetch @LIBS@
 .if !empty(SSL_SUPPORT)
-LIBS+=		-lcrypto
+LIBS+=		-lcrypto -lz
 .endif
 CPPFLAGS=	@CPPFLAGS@ -I. -I$(srcdir) -I../lib
 .else
diff -r b7cf414332ca pkgtools/pkg_install/files/lib/dewey.c
--- a/pkgtools/pkg_install/files/lib/dewey.c	Fri May 04 14:07:09 2012 +0000
+++ b/pkgtools/pkg_install/files/lib/dewey.c	Sun May 06 13:12:36 2012 +0000
@@ -39,6 +39,7 @@
 #if HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
+#include <unistd.h> /* for ssize_t */
 
 #include "defs.h"
 #include "dewey.h"
diff -r b7cf414332ca print/a2ps/distinfo
--- a/print/a2ps/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/print/a2ps/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -7,3 +7,4 @@
 SHA1 (patch-ab) = 7b1f1e3ed2af47e7d9864ec2dbcd7d105f93632a
 SHA1 (patch-ac) = 8e09c4c3b320b58bf12c4266d4d22977b5f9b826
 SHA1 (patch-lib_path-concat.c) = b345a7b16559315223dcbb182e92feccca7e6e2f
+SHA1 (patch-qq) = c6fc0a95e7003c055da2dc1ebea316638a1cc3e9
diff -r b7cf414332ca print/a2ps/patches/patch-qq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/print/a2ps/patches/patch-qq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,23 @@
+diff -r b585ce465a54 lib/path-concat.c
+--- lib/path-concat.c	Sun May 06 04:40:07 2012 +0000
++++ lib/path-concat.c	Sun May 06 04:42:23 2012 +0000
+@@ -21,16 +21,15 @@
+ # include <config.h>
+ #endif
+ 
+-#if !defined(HAVE_MEMPCPY) && !defined(__DragonFly__)
+-# define mempcpy(D, S, N) ((void *) ((char *) memcpy (D, S, N) + (N)))
+-#endif
+-
+ #include <stdio.h>
+ #if HAVE_STRING_H
+ # include <string.h>
+ #endif
+ #include <sys/types.h>
+ 
++#if !defined(HAVE_MEMPCPY) && !defined(__DragonFly__)
++# define mempcpy(D, S, N) ((void *) ((char *) memcpy (D, S, N) + (N)))
++#endif
+ /* char *malloc (); */
+ 
+ #ifndef DIRECTORY_SEPARATOR
diff -r b7cf414332ca security/dropbear/Makefile
--- a/security/dropbear/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/security/dropbear/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -53,6 +53,8 @@
 
 BUILD_TARGET=		all scp
 
+CONFIGURE_ARGS+=	--disable-lastlog
+
 post-install:
 	${INSTALL_MAN} ${WRKSRC}/dbclient.1 \
 		${DESTDIR}/${PREFIX}/${PKGMANDIR}/man1
diff -r b7cf414332ca security/libgpg-error/PLIST
--- a/security/libgpg-error/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/security/libgpg-error/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -8,13 +8,3 @@
 share/common-lisp/source/gpg-error/gpg-error-package.lisp
 share/common-lisp/source/gpg-error/gpg-error.asd
 share/common-lisp/source/gpg-error/gpg-error.lisp
-share/locale/cs/LC_MESSAGES/libgpg-error.mo
-share/locale/de/LC_MESSAGES/libgpg-error.mo
-share/locale/fr/LC_MESSAGES/libgpg-error.mo
-share/locale/it/LC_MESSAGES/libgpg-error.mo
-share/locale/nl/LC_MESSAGES/libgpg-error.mo
-share/locale/pl/LC_MESSAGES/libgpg-error.mo
-share/locale/ro/LC_MESSAGES/libgpg-error.mo
-share/locale/sv/LC_MESSAGES/libgpg-error.mo
-share/locale/vi/LC_MESSAGES/libgpg-error.mo
-share/locale/zh_CN/LC_MESSAGES/libgpg-error.mo
diff -r b7cf414332ca security/openpam/distinfo
--- a/security/openpam/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/security/openpam/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -12,3 +12,4 @@
 SHA1 (patch-ah) = 5cef165a6986e0146f75cc4aa4fe5c0adc2d5042
 SHA1 (patch-ai) = ebd22192a6b34161feac281ade41340493142e2b
 SHA1 (patch-aj) = f106a68e24fabae7353ea4480c75ba84097ec606
+SHA1 (patch-aq) = b8310fd7a88d4a6703ac5b724e5ca1406337b5d1
diff -r b7cf414332ca security/openpam/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/security/openpam/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,12 @@
+diff -r f26e7457d1df lib/openpam_impl.h
+--- lib/openpam_impl.h	Sun May 06 03:31:16 2012 +0000
++++ lib/openpam_impl.h	Sun May 06 03:33:03 2012 +0000
+@@ -42,6 +42,8 @@
+ # include <config.h>
+ #endif
+ 
++#include <sys/types.h>
++
+ #include <security/openpam.h>
+ 
+ extern const char *_pam_func_name[PAM_NUM_PRIMITIVES];
diff -r b7cf414332ca security/openssl/Makefile
--- a/security/openssl/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/security/openssl/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -61,6 +61,7 @@
 # back to ./config's autodetection if not.
 .  if defined(OPENSSL_MACHINE_ARCH) && !empty(OPENSSL_MACHINE_ARCH)
 CONFIGURE_SCRIPT=	./Configure
+CONFIGURE_ARGS+=	no-shared no-dso zlib enable-md2 -Wa,--noexecstack
 .    if !empty(CC_VERSION:Mgcc*)
 CONFIGURE_ARGS+=	solaris${${ABI}==64:?64:}-${OPENSSL_MACHINE_ARCH}-gcc
 .    else
@@ -154,8 +155,16 @@
 
 INSTALLATION_DIRS+=	share/examples/openssl
 
+pre-build:
+	touch ${WRKSRC}/include/memory.h
+	cd ${WRKSRC} && $(MAKE) depend
+
 # Fix the path to perl in various scripts.
 pre-configure:
 	cd ${WRKSRC} && ${PERL5} util/perlpath.pl ${PERL5}
-
+	sed -i '/^"linux-x86_64/s/-DTERMIO/-DTERMIOS/' ${WRKSRC}/Configure
+	sed -i '/^"linux-elf/s/-DTERMIO/-DTERMIOS/' ${WRKSRC}/Configure
+	sed -i 's/defined(linux)/0/' ${WRKSRC}/crypto/ui/ui_openssl.c
+	sed -i 's/\!defined(_UNICOS)/0/' ${WRKSRC}/apps/speed.c
+	
 .include "../../mk/bsd.pkg.mk"
diff -r b7cf414332ca security/policykit/distinfo
--- a/security/policykit/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/security/policykit/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -19,3 +19,4 @@
 SHA1 (patch-an) = a0a54235fc72a52ace72a0d04df6c1383f7c583c
 SHA1 (patch-ao) = 0f9a87653f4902285c7420f6269e302eca896a1b
 SHA1 (patch-authdb) = 449b8ac50f81cc0234e17e64bc9892ade7119028
+SHA1 (patch-aq) = 07d7453aba399fd3b61e05a46ec20f6080be7fde
diff -r b7cf414332ca security/policykit/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/security/policykit/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,11 @@
+diff -r 1ceaf4291bd1 src/polkit-dbus/polkit-resolve-exe-helper.c
+--- src/polkit-dbus/polkit-resolve-exe-helper.c	Sun May 06 03:39:34 2012 +0000
++++ src/polkit-dbus/polkit-resolve-exe-helper.c	Sun May 06 03:39:59 2012 +0000
+@@ -52,6 +52,7 @@
+ #include <utime.h>
+ #include <fcntl.h>
+ #include <dirent.h>
++#include <limits.h>
+ 
+ #include <polkit-dbus/polkit-dbus.h>
+ #include <polkit/polkit-private.h>
diff -r b7cf414332ca shells/bash/Makefile
--- a/shells/bash/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/shells/bash/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -78,6 +78,9 @@
 .include "../../devel/readline/buildlink3.mk"
 .endif
 
+# [Gregor] mischeck for musl, safe everywhere
+CONFIGURE_ARGS+=		--without-bash-malloc
+
 post-install:
 	${INSTALL_MAN} ${WRKSRC}/doc/bash.1 ${DESTDIR}${PREFIX}/${PKGMANDIR}/man1
 	${INSTALL_MAN} ${WRKSRC}/doc/bashbug.1 ${DESTDIR}${PREFIX}/${PKGMANDIR}/man1
diff -r b7cf414332ca shells/dash/Makefile
--- a/shells/dash/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/shells/dash/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -16,4 +16,6 @@
 USE_TOOLS+=		gmake
 PKG_SHELL=		bin/dash
 
+CONFIGURE_ARGS+=	CFLAGS="-O2 -g -DEXECCMD=1 -DCOMMANDCMD=2"
+
 .include "../../mk/bsd.pkg.mk"
diff -r b7cf414332ca sysutils/coreutils/Makefile
--- a/sysutils/coreutils/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/sysutils/coreutils/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -39,6 +39,8 @@
 #MESSAGE_SUBST+=	OPSYS=${OPSYS:Q}
 #.endif
 
+CFLAGS+=		-DSLOW_BUT_NO_HACKS
+
 .include "../../converters/libiconv/buildlink3.mk"
 .include "../../devel/gettext-lib/buildlink3.mk"
 .include "../../mk/bsd.pkg.mk"
diff -r b7cf414332ca sysutils/coreutils/distinfo
--- a/sysutils/coreutils/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/sysutils/coreutils/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -5,3 +5,4 @@
 Size (coreutils-8.13.tar.gz) = 11660808 bytes
 SHA1 (patch-lib-fflush.c) = e52e0da2127c5debbb14e967b1e206226efdaa4a
 SHA1 (patch-lib-fseeko.c) = ab62b8c7faa9a601191475c040c7466e1bd52fe1
+SHA1 (patch-aq) = 02186df2372b3317cc2df6a8230cc198ac3eb4e9
diff -r b7cf414332ca sysutils/coreutils/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/sysutils/coreutils/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,23 @@
+diff -r fb0a1c120d18 lib/fseterr.c
+--- lib/fseterr.c	Sat May 05 16:00:33 2012 +0000
++++ lib/fseterr.c	Sat May 05 16:05:52 2012 +0000
+@@ -71,6 +71,6 @@
+     }
+   errno = saved_errno;
+ #else
+- #error "Please port gnulib fseterr.c to your platform! Look at the definitions of ferror and clearerr on your system, then report this to bug-gnulib."
++  return 1;
+ #endif
+ }
+diff -r fb0a1c120d18 src/dd.c
+--- src/dd.c	Sat May 05 16:00:33 2012 +0000
++++ src/dd.c	Sat May 05 16:05:52 2012 +0000
+@@ -1375,7 +1375,7 @@
+    The offending behavior has been confirmed with an Exabyte SCSI tape
+    drive accessed via /dev/nst0 on both Linux 2.2.17 and 2.4.16 kernels.  */
+ 
+-#ifdef __linux__
++#if 0
+ 
+ # include <sys/mtio.h>
+ 
diff -r b7cf414332ca sysutils/gamin/distinfo
--- a/sysutils/gamin/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/sysutils/gamin/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -16,3 +16,4 @@
 SHA1 (patch-server_gam__node.h) = 49a0d381b4900564c4f0ba7a654eb22e294c0a16
 SHA1 (patch-server_gam__subscription.c) = 58f6c10e4e1e899d097662536ea31bf8a692b114
 SHA1 (patch-server_gam__subscription.h) = 6347865210aa0338bc8b0a81fc671824c786fd26
+SHA1 (patch-aq) = 6d30c2cb4ef9504a704a50168899a11c8c0db78a
diff -r b7cf414332ca sysutils/gamin/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/sysutils/gamin/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,15 @@
+diff -r a17041040b0f server/gam_dnotify.c
+--- server/gam_dnotify.c	Sun May 06 05:06:48 2012 +0000
++++ server/gam_dnotify.c	Sun May 06 05:13:29 2012 +0000
+@@ -19,6 +19,11 @@
+ 
+ #include "server_config.h"
+ #define _GNU_SOURCE
++#if defined(__linux__) && !defined(__GLIBC__)
++/* need to do this nasty hack until/unless musl exposes the right #defines */
++#define HAVE_ARCH_STRUCT_FLOCK
++#include <linux/fcntl.h>
++#endif
+ #include <fcntl.h>
+ #include <signal.h>
+ #include <unistd.h>
diff -r b7cf414332ca sysutils/pciutils/distinfo
--- a/sysutils/pciutils/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/sysutils/pciutils/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -7,3 +7,4 @@
 SHA1 (patch-ab) = 1448bb418cdc908eb6652cc98994d23d0d78cea0
 SHA1 (patch-ac) = c917e8ad2d1e87fa65a2d8f3256afd40d5a87396
 SHA1 (patch-ad) = bfe9069e96fd46798afec73c93ad71db3a0e0e37
+SHA1 (patch-aq) = b29a7e176a23456b6c509e5c40326d5a59050b8c
diff -r b7cf414332ca sysutils/pciutils/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/sysutils/pciutils/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,12 @@
+diff -r 63e97996f76b lib/configure
+--- lib/configure	Sun May 06 02:42:29 2012 +0000
++++ lib/configure	Sun May 06 02:42:58 2012 +0000
+@@ -68,7 +68,7 @@
+ 		echo >>$c '#define PCI_PATH_PROC_BUS_PCI "/proc/bus/pci"'
+ 		echo >>$c '#define PCI_PATH_SYS_BUS_PCI "/sys/bus/pci"'
+ 		case $cpu in
+-				i?86|x86_64)	echo_n " i386-ports"
++				disabled-i?86|disabled-x86_64)	echo_n " i386-ports"
+ 						echo >>$c '#define PCI_HAVE_PM_INTEL_CONF'
+ 						;;
+ 		esac
diff -r b7cf414332ca sysutils/xfce4-thunar/distinfo
--- a/sysutils/xfce4-thunar/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/sysutils/xfce4-thunar/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -7,3 +7,4 @@
 SHA1 (patch-ab) = e5c3f1e853bf59f69047c7160a3e29df54298879
 SHA1 (patch-ac) = 745f240ff44b0b21eb727b0a9887c9d8f1ee8a47
 SHA1 (patch-thunar-vfs_thunar-vfs-io-jobs.c) = 8529460dea3353b7b8bb034c65c95e4561f61aab
+SHA1 (patch-aq) = dd802620cec6c8d76a4ae09e5a155f2b01fd3558
diff -r b7cf414332ca sysutils/xfce4-thunar/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/sysutils/xfce4-thunar/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,11 @@
+diff -r f88137634fb9 tdb/tdb.h
+--- tdb/tdb.h	Sun May 06 09:10:30 2012 +0000
++++ tdb/tdb.h	Sun May 06 11:32:55 2012 +0000
+@@ -29,6 +29,7 @@
+ 
+ #include <signal.h>
+ #include <unistd.h>
++#include <sys/types.h>
+ 
+ #ifdef  __cplusplus
+ extern "C" {
diff -r b7cf414332ca textproc/groff/PLIST
--- a/textproc/groff/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/textproc/groff/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -15,9 +15,6 @@
 bin/grops
 bin/grotty
 bin/hpftodit
-bin/${GNU_PREFIX}indxbib
-bin/lkbib
-bin/${GNU_PREFIX}lookbib
 bin/mmroff
 bin/${GNU_PREFIX}neqn
 bin/${GNU_PREFIX}nroff
@@ -28,7 +25,6 @@
 bin/post-grohtml
 bin/pre-grohtml
 bin/preconv
-bin/${GNU_PREFIX}refer
 bin/roff2dvi
 bin/roff2html
 bin/roff2pdf
@@ -40,11 +36,11 @@
 bin/tfmtodit
 bin/${GNU_PREFIX}troff
 info/groff.info
-lib/groff/groffer/func.pl
-lib/groff/groffer/man.pl
-lib/groff/groffer/perl_test.pl
-lib/groff/groffer/split_env.sh
-lib/groff/groffer/version.sh
+@comment lib/groff/groffer/func.pl
+@comment lib/groff/groffer/man.pl
+@comment lib/groff/groffer/perl_test.pl
+@comment lib/groff/groffer/split_env.sh
+@comment lib/groff/groffer/version.sh
 man/man1/addftinfo.1
 man/man1/afmtodit.1
 man/man1/chem.1
diff -r b7cf414332ca textproc/libxml2/Makefile
--- a/textproc/libxml2/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/textproc/libxml2/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -24,6 +24,7 @@
 CONFIGURE_ARGS+=	--with-iconv=${BUILDLINK_PREFIX.iconv}
 CONFIGURE_ARGS+=	--with-html-subdir=libxml2
 CONFIGURE_ARGS+=	--without-python
+CONFIGURE_ARGS+=	--without-threads
 
 .include "options.mk"
 
@@ -43,6 +44,9 @@
 SUBST_SED.cat=	-e "s,@@SGML_DEFAULT_CATALOG@@,${SGML_DEFAULT_CATALOG},g"
 SUBST_SED.cat+=	-e "s,@@XML_DEFAULT_CATALOG@@,${XML_DEFAULT_CATALOG},g"
 
+pre-build:
+	sed 's/NO_ADDRESS/-1/' -i ${WRKSRC}/nanohttp.c
+
 .include "../../mk/pthread.buildlink3.mk"
 .include "../../devel/zlib/buildlink3.mk"
 .include "../../converters/libiconv/buildlink3.mk"
diff -r b7cf414332ca wm/bsetroot/PLIST
--- a/wm/bsetroot/PLIST	Fri May 04 14:07:09 2012 +0000
+++ b/wm/bsetroot/PLIST	Sun May 06 13:12:36 2012 +0000
@@ -3,37 +3,3 @@
 bin/bsetroot
 man/man1/bsetbg.1
 man/man1/bsetroot.1
-share/bsetroot/nls/POSIX
-share/bsetroot/nls/US_ASCII
-share/bsetroot/nls/de
-share/bsetroot/nls/en
-share/bsetroot/nls/en_GB
-share/bsetroot/nls/en_US
-share/bsetroot/nls/es
-share/bsetroot/nls/es_MX
-share/bsetroot/nls/fr
-share/bsetroot/nls/it
-share/bsetroot/nls/nl
-share/bsetroot/nls/C/blackbox.cat
-share/bsetroot/nls/da_DK/blackbox.cat
-share/bsetroot/nls/de_DE/blackbox.cat
-share/bsetroot/nls/es_AR/blackbox.cat
-share/bsetroot/nls/es_ES/blackbox.cat
-share/bsetroot/nls/fr_FR/blackbox.cat
-share/bsetroot/nls/hu_HU/blackbox.cat
-share/bsetroot/nls/it_IT/blackbox.cat
-share/bsetroot/nls/ja_JP/blackbox.cat
-share/bsetroot/nls/ko_KR/blackbox.cat
-share/bsetroot/nls/lv_LV/blackbox.cat
-share/bsetroot/nls/nl_NL/blackbox.cat
-share/bsetroot/nls/no_NO/blackbox.cat
-share/bsetroot/nls/pl_PL/blackbox.cat
-share/bsetroot/nls/pt_BR/blackbox.cat
-share/bsetroot/nls/ro_RO/blackbox.cat
-share/bsetroot/nls/ru_RU/blackbox.cat
-share/bsetroot/nls/sk_SK/blackbox.cat
-share/bsetroot/nls/sl_SI/blackbox.cat
-share/bsetroot/nls/sv_SE/blackbox.cat
-share/bsetroot/nls/uk_UA/blackbox.cat
-share/bsetroot/nls/zh_CN/blackbox.cat
-share/bsetroot/nls/zh_TW/blackbox.cat
diff -r b7cf414332ca x11/libFS/Makefile
--- a/x11/libFS/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/x11/libFS/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -25,6 +25,8 @@
 CONFIGURE_ARGS+=	--disable-malloc0returnsnull
 .endif
 
+CONFIGURE_ARGS+=	CFLAGS="-O2 -g -DNOFILES_MAX=256"
+
 .include "../../x11/fontsproto/buildlink3.mk"
 .include "../../x11/xproto/buildlink3.mk"
 .include "../../x11/xtrans/buildlink3.mk"
diff -r b7cf414332ca x11/libXfont/Makefile
--- a/x11/libXfont/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/x11/libXfont/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -20,6 +20,7 @@
 PKGCONFIG_OVERRIDE+=	xfont.pc.in
 
 CONFIGURE_ARGS+=	--disable-devel-docs
+CONFIGURE_ARGS+=	CFLAGS="-O2 -g -DNOFILES_MAX=256"
 
 .include "../../devel/zlib/buildlink3.mk"
 .include "../../graphics/freetype2/buildlink3.mk"
diff -r b7cf414332ca x11/libxcb/Makefile
--- a/x11/libxcb/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/x11/libxcb/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -74,6 +74,8 @@
 
 PYTHON_VERSIONS_ACCEPTED= 27 26 25
 
+BUILD_DEPENDS+=		py27-cElementTree-[0-9]*:../../textproc/py-cElementTree
+
 post-extract:
 	${CHMOD} -R go-w ${WRKSRC}
 
diff -r b7cf414332ca x11/libxfce4menu/distinfo
--- a/x11/libxfce4menu/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/x11/libxfce4menu/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -3,3 +3,4 @@
 SHA1 (libxfce4menu-4.6.1.tar.bz2) = 17348f661c04e8d8d633b8831638d38987269e9a
 RMD160 (libxfce4menu-4.6.1.tar.bz2) = 978071d28288bd737219e4a9c4185937b2fbf50b
 Size (libxfce4menu-4.6.1.tar.bz2) = 404201 bytes
+SHA1 (patch-aq) = 819f9876969820c0b8beb98a0cd7580eb59237dc
diff -r b7cf414332ca x11/libxfce4menu/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/x11/libxfce4menu/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,11 @@
+diff -r 24e4986df43b tdb/tdb.h
+--- tdb/tdb.h	Sun May 06 11:48:51 2012 +0000
++++ tdb/tdb.h	Sun May 06 11:49:25 2012 +0000
+@@ -29,6 +29,7 @@
+ 
+ #include <signal.h>
+ #include <unistd.h>
++#include <sys/types.h>
+ 
+ #ifdef  __cplusplus
+ extern "C" {
diff -r b7cf414332ca x11/pixman/Makefile
--- a/x11/pixman/Makefile	Fri May 04 14:07:09 2012 +0000
+++ b/x11/pixman/Makefile	Sun May 06 13:12:36 2012 +0000
@@ -42,5 +42,8 @@
 post-extract:
 	${CP} ${FILESDIR}/pixman.sym ${WRKDIR}
 	${CP} ${FILESDIR}/solaris-hwcap.mapfile ${WRKSRC}/pixman
-
+	
+pre-configure:
+	sed -i 's/support_for__thread=yes/support_for__thread=no/' ${WRKSRC}/configure	
+	
 .include "../../mk/bsd.pkg.mk"
diff -r b7cf414332ca x11/vte/distinfo
--- a/x11/vte/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/x11/vte/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -9,3 +9,4 @@
 SHA1 (patch-af) = 69ea7e022f6c495c3c9af681d05644b9d70e7bdc
 SHA1 (patch-ah) = 28cee2661439d7d6f1959ebf3c7d1b7b3fe0a764
 SHA1 (patch-ai) = 986dd7c2a5778c9c35100901cfaa25acd0cbdc32
+SHA1 (patch-aq) = 8262b1ccde6869c18a27994dd19e469b5430b05a
diff -r b7cf414332ca x11/vte/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/x11/vte/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,19 @@
+diff -r fecfb00f45d9 src/pty.c
+--- src/pty.c	Sun May 06 12:32:48 2012 +0000
++++ src/pty.c	Sun May 06 12:34:08 2012 +0000
+@@ -290,6 +290,7 @@
+ #endif
+ 
+ #ifdef HAVE_STROPTS_H
++#if 0
+ 	if (isastream (fd) == 1) {
+ 		if ((ioctl(fd, I_FIND, "ptem") == 0) &&
+ 				(ioctl(fd, I_PUSH, "ptem") == -1)) {
+@@ -306,6 +307,7 @@
+ 		}
+ 	}
+ #endif
++#endif
+ 
+ 	/* now setup child I/O through the tty */
+ 	if (fd != STDIN_FILENO) {
diff -r b7cf414332ca x11/xinit/distinfo
--- a/x11/xinit/distinfo	Fri May 04 14:07:09 2012 +0000
+++ b/x11/xinit/distinfo	Sun May 06 13:12:36 2012 +0000
@@ -3,3 +3,4 @@
 SHA1 (xinit-1.2.1.tar.bz2) = baf36374aa1632054816a8281e55e1539459664b
 RMD160 (xinit-1.2.1.tar.bz2) = 993b068e4758521ed930bd78069c291b68d88037
 Size (xinit-1.2.1.tar.bz2) = 141441 bytes
+SHA1 (patch-aq) = 98a0f800293163faa1392090842a6994485e8204
diff -r b7cf414332ca x11/xinit/patches/patch-aq
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/x11/xinit/patches/patch-aq	Sun May 06 13:12:36 2012 +0000
@@ -0,0 +1,12 @@
+diff -r 55926f90284b xinit.c
+--- xinit.c	Sun May 06 12:44:26 2012 +0000
++++ xinit.c	Sun May 06 12:44:44 2012 +0000
+@@ -153,7 +153,7 @@
+ static char *program = NULL;
+ static Display *xd = NULL;			/* server connection */
+ #ifndef SYSV
+-#if defined(__CYGWIN__) || defined(SVR4) || defined(_POSIX_SOURCE) || defined(CSRG_BASED) || defined(__UNIXOS2__) || defined(Lynx) || defined(__APPLE__)
++#if defined(__CYGWIN__) || defined(SVR4) || defined(_POSIX_SOURCE) || defined(CSRG_BASED) || defined(__UNIXOS2__) || defined(Lynx) || defined(__APPLE__) || 1
+ int status;
+ #else
+ union wait	status;
